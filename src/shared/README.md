# 项目协作文档 - 后台管理系统优化

## 项目概述

**技术栈**：TypeScript、Vite、Ant Design、Zustand  
**架构模式**：pnpm workspaces monorepo  
**项目类型**：后台管理系统优化与功能增强

## 常用命令

### 开发相关
- `pnpm install -w` - 安装所有依赖（monorepo 工作区）
- `pnpm dev` / `pnpm dev:localhost` - 启动开发服务器（端口 7000）
- `pnpm dev:mock` - 使用 mock 数据启动
- `pnpm dev:dev` - 开发模式启动
- `pnpm preview` - 预览构建后的应用

### 构建与质量检查
- `pnpm build` - 生产环境构建
- `pnpm build:dev` - 开发环境构建
- `pnpm build:test` - 测试环境构建
- `pnpm lint` - 修复 ESLint 问题
- `pnpm lint:stylelint` - 修复样式问题
- `pnpm prettier` - 格式化代码

### Git 提交规范
- `feat` - 新功能
- `fix` - 修复问题  
- `refactor` - 代码重构
- `style` - 代码风格相关
- `perf` - 性能优化
- `docs` - 文档相关
- `chore` - 依赖更新/配置修改

## 架构与核心模式

### 路由系统
- 基于 `src/pages/` 文件结构自动生成路由
- 支持 KeepAlive 组件缓存

### 核心依赖包
- `@manpao/request` - HTTP 请求工具
- `@manpao/utils` - 通用工具集
- `@manpao/status-codes` - 状态码管理
- `@manpao/stylelint` - 样式检查配置

### UI 框架
- Ant Design v5 配合 CSS-in-JS
- UnoCSS 用于工具类样式  
- Less 用于组件样式
- 自定义主题配置

### 状态管理
- `src/stores/menu.ts` - 菜单数据
- `src/stores/tabs.ts` - 标签页状态
- `src/stores/token.ts` - Token 管理

### 通用模板
- `src/shared/components/CRUDPageTemplate.tsx` - CRUD 页面模板
- `src/shared/hooks/useCRUD.ts` - CRUD 操作 Hook
- `src/components/Form/BaseForm.tsx` - 表单基础组件
- `src/components/Table/BaseTable.tsx` - 表格基础组件（支持虚拟滚动）

## 待处理需求清单

### 1. UI 统一性优化模块
#### 1.1 分页组件统一
**问题描述**：后台右下角页码样式不统一，特别是交易流水页面  
**影响范围**：交易流水
**优先级**：中

### 2. 学校管理模块

#### 2.1 学校添加功能修复
**问题描述**：无法添加学校  
**影响范围**：学校管理页面
**优先级**：紧急


#### 2.2 学校地址转换功能
**问题描述**：需要实现学校经纬度转地址功能  
**影响范围**：学校信息展示
**优先级**：中

### 3. 城市运营商模块

#### 3.1 新增城市运营商管理
**问题描述**：需要修复新增城市运营商管理模块  
**影响范围**：新增城市运营商管理
**优先级**：高

#### 3.2 团长管理优化
**问题描述**：城市运营商新增团长时不能选择城市  
**影响范围**：团长管理功能
**优先级**：高

#### 3.3 修复团长状态编辑
**问题描述**：团长没法编辑状态  
**影响范围**：团长管理功能
**优先级**：中

### 4. 交易流水模块

#### 4.1 导出数据优化
**问题描述**：导出数据需要用户能看懂的文字，不要数字代码（如状态码）  
**影响范围**：数据导出功能
**优先级**：高

#### 4.2 未知学校显示优化
**问题描述**：未知学校需要显示为"-"  
**影响范围**：交易流水显示
**优先级**：低

#### 4.3 用户导出功能
**问题描述**：实现用户导出可以不在当前页面的状态  
**影响范围**：导出功能
**优先级**：中

### 5. 实名认证模块

#### 5.1 添加筛选功能
**问题描述**：需要加省份、城市、学校筛选  
**影响范围**：实名认证页面
**优先级**：高

#### 5.2 添加字段
**问题描述**：添加省份、城市和学校字段  
**影响范围**：实名认证数据结构
**优先级**：高

---

## 协作节奏规范

### Step Plan 结构

每个实施步骤必须包含以下要素：

1. **步骤目标**：明确本步要实现的功能点
2. **关键概念**：涉及的核心技术知识点
3. **设计取舍**：技术方案选择的理由
4. **技术背景**：相关技术/函数的使用说明
5. **失败模式**：常见的失败场景及应对
6. **回滚策略**：出现问题时的恢复方案
7. **任务清单**：用 `TODO(human)` 标注关键实现点

### 步长控制标准

- **最小步（15-20分钟）**：单个函数或微功能实现
- **标准步（25-35分钟）**：完整模块或中间件开发
- **组合步（35-45分钟）**：多模块集成或包含测试


---

## 项目约定

### 代码规范
1. 所有新增代码必须通过 ESLint 和 Prettier 检查
2. 组件命名使用 PascalCase
3. 函数和变量使用 camelCase
4. 常量使用 UPPER_SNAKE_CASE

### 测试要求
1. 关键功能必须有单元测试
2. API 接口需要集成测试
3. UI 交互需要 E2E 测试

### 文档要求
1. 新增功能需要更新 README
2. API 变更需要更新接口文档
3. 复杂逻辑需要添加代码注释

### 版本控制
1. 功能分支命名：`feature/功能名称`
2. 修复分支命名：`fix/问题描述`
3. 每个 PR 必须有详细描述

---

## 风险与应对

### 技术风险

1. **数据量过大**：交易流水导出可能造成内存溢出
   - 应对：采用流式处理，分批导出

2. **兼容性问题**：不同浏览器的样式差异
   - 应对：使用 PostCSS 自动添加前缀

### 业务风险
1. **数据一致性**：并发操作可能导致数据冲突
   - 应对：实现乐观锁机制

2. **权限控制**：新功能可能存在权限漏洞
   - 应对：严格的权限测试

---

## 深度思考要点

在实施每个功能时，需要深入考虑：

1. **性能影响**：新功能对系统性能的影响如何？
2. **用户体验**：改动是否真正提升了用户体验？
3. **可维护性**：代码是否易于后续维护和扩展？
4. **安全性**：是否存在潜在的安全风险？
5. **兼容性**：是否考虑了向后兼容？
6. **可测试性**：功能是否便于测试？
7. **文档完整性**：是否有充分的文档支持？

---
